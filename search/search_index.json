{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Django VectorDB","text":"<p>Django Vector DB is a powerful and flexible toolkit for adding vector search capabilities to your Django applications. It is built on top of lightening fast nearest neighbor search library: hnswlib.</p> <p>Some reasons you might want to use Django Vector DB:</p> <ul> <li>Low latency, because you don't need to call an external API.</li> <li>Scalable to a billion vectors with millisecond search results.</li> <li>Fast and accurate search.</li> <li>Native Django integration.</li> <li>Metadata filtering with the full power of the django queryset queries, e.g. <code>vectordb.filter(metadata__user_id=1).search(\"some text\").only(\"text\")</code></li> <li>Automatic syncing between your models and the vector index, simply register the provided signals and you can continue about your day. Vectordb will sync the vector database whenever you create, update or delete an instance.</li> <li>Out of the box support for incremental updates, allowing you to add or update data without rebuilding the entire index.</li> <li>Extensive documentation and support for easy implementation and troubleshooting.</li> </ul>"},{"location":"#requirements","title":"Requirements","text":"<p>Django VectorDB requires the following:</p> <ul> <li>Python (3.6, 3.7, 3.8, 3.9, 3.10, 3.11)</li> <li>Django (2.2, 3.0, 3.1, 3.2, 4.0, 4.1, 4.2)</li> <li>HNSWLib (0.7.0)</li> <li>numpy</li> </ul> <p>We highly recommend and only officially support the latest patch release of each Python and Django series.</p> <p>The following packages are optional:</p> <ul> <li>Sentence-Transformers - Add support for converting text into vector embeddings used for similarity search</li> <li>Django Rest Framework - Add API endpoint for VectorDB.</li> <li>django-filters - Add metadata filtering support on the API endpoint.</li> </ul>"},{"location":"#installation","title":"Installation","text":"<p>Install using <code>pip</code>, it is recommended that you install the optional packages with:</p> <pre><code># This will install the optional dependencies above.\npip install \"django-vectordb[standard]\"\n</code></pre> <p>If you dont want to install the optional packages you can run:</p> <pre><code>pip install django-vectordb\n</code></pre> <p>Add <code>'django-vectordb'</code> to your <code>INSTALLED_APPS</code> setting.</p> settings.py<pre><code>INSTALLED_APPS = [\n...\n'vectordb',\n]\n</code></pre> <p>Run the migrations to create the <code>vectordb</code> table</p> <pre><code>$ ./manage.py migrate\n</code></pre> <p>If you're intending to use the API, you'll probably also want to add vectordb.urls. Add the following to your root <code>urls.py</code> file.</p> urls.py<pre><code>urlpatterns = [\n...\npath('api/', include('vectordb.urls'))\n]\n</code></pre> <p>Note: that the URL path can be whatever you want.</p> <p>This will expose endpoints for all CRUD actions (<code>/api/vectordb/</code>) and searching (<code>/api/vectordb/search/</code>).</p>"},{"location":"#example","title":"Example","text":"<p>Lets beging with a simple example for blog posts</p> blog/models.py<pre><code>from django.db import models\nfrom django.contrib.auth import get_user_model\nUser = get_user_model()\nclass Post(models.Model):\ntitle = models.CharField(max_length=100)\ndescription = models.TextField()\nuser = models.ForeignKey(User, on_delete = models.CASCADE)\ndef __str__(self):\nreturn self.title\n</code></pre>"},{"location":"#1-importing","title":"1. Importing","text":"<p>To begin working with VectorDB, you'll first need to import it into your project. There are two ways to do this, depending on whether you'd like to use the simple proxy to the vector models manager, <code>Vector.objects</code>, or the Vector model directly.</p>"},{"location":"#option-1-import-the-simple-proxy-recommended","title":"Option 1: Import the simple proxy [Recommended]","text":"<pre><code>from vectordb import vectordb\n</code></pre>"},{"location":"#option-2-import-the-vector-model-directly","title":"Option 2: Import the Vector model directly","text":"<pre><code>from vectordb import get_vectordb_model\nVectorModel = get_vectordb_model()\n</code></pre> <p>With either of these imports, you'll have access to all the Django manager functions available on the object. Note that you can run the commands detailed below using <code>vectordb</code> or <code>VectorModel.objects</code>, whichever you've chosen to import. For the rest of this guide we will use <code>vectordb</code>.</p> <p>Now that you've imported VectorDB, it's time to dive in and explore its powerful features!</p>"},{"location":"#populating-the-vector-database","title":"Populating the Vector Database","text":"<p>First, let's make a few updates to the model to allow VectorDB to handle most tasks for us: add <code>get_vectordb_text</code> and <code>get_vectordb_metadata</code> methods.</p> blog/models.py<pre><code>from django.db import models\nfrom django.contrib.auth import get_user_model\nUser = get_user_model()\nclass Post(models.Model):\ntitle = models.CharField(max_length=100)\ndescription = models.TextField()\nuser = models.ForeignKey(User, on_delete=models.CASCADE)\ndef __str__(self):\nreturn self.title\ndef get_vectordb_text(self):\n# Use title and description for vector search\nreturn f\"{self.title} -- {self.description}\"\ndef get_vectordb_metadata(self):\n# Enable filtering by any of these metadata\nreturn {\"title\": self.title, \"description\": self.description, \"user_id\": self.user.id, \"model\": \"post\"}\n</code></pre> <p>In an existing project, you can run the <code>vectordb_sync</code> management command to add all items to the database.</p> <pre><code>./manage.py vectordb_sync &lt;app_name&gt; &lt;model_name&gt;\n</code></pre> <p>For this example:</p> <pre><code>./manage.py vectordb_sync blog Post\n</code></pre>"},{"location":"#manually-adding-items-to-the-vector-database","title":"Manually adding items to the vector database","text":"<p>VectorDB provides two utility methods for adding items to the database: <code>vectordb.add_instance</code> or <code>vectordb.add_text</code>. Note that for adding the instance, you need to provide the <code>get_vectordb_text</code> and an optional <code>get_vectordb_metadata</code> methods.</p>"},{"location":"#1-adding-model-instances","title":"1. Adding Model Instances","text":"<pre><code>post1 = models.create(title=\"post1\", description=\"post1 description\", user=user1) # provide valid user\n# add to vector database\nvectordb.add_instance(post1)\n</code></pre>"},{"location":"#2-adding-text-to-the-model","title":"2. Adding Text to the Model","text":"<p>To add text to the database, you can use <code>vectordb.add_text()</code>:</p> <pre><code>vectordb.add_text(text=\"Hello text\", id=3, metadata={\"user_id\": 1})\n</code></pre> <p>The <code>text</code> and <code>id</code> are required. Additionally, the <code>id</code> must be unique, or an error will occur. <code>metadata</code> can be <code>None</code> or any valid JSON.</p>"},{"location":"#automatically-syncing-your-model-to-the-vector-database","title":"Automatically Syncing Your Model to the vector database","text":"<p>To enable auto sync, import the following signals and register them with your models:</p> blog/signals.py<pre><code># signals.py\nfrom django.db.models.signals import post_save, post_delete\nfrom vectordb.sync_signals import (\nsync_vectordb_on_create_update,\nsync_vectordb_on_delete,\n)\nfrom .models import Post\npost_save.connect(\nsync_vectordb_on_create_update,\nsender=Post,\ndispatch_uid=\"update_vector_index_super_unique_id\",\n)\npost_delete.connect(\nsync_vectordb_on_delete,\nsender=Post,\ndispatch_uid=\"delete_vector_index_super_unique_id\",\n)\n</code></pre> <p>You can reduce the above code by using shortcut provided by vectordb as follows</p> blog/signals.py<pre><code>from vectordb.shortcuts import autosync_model_to_vectordb\nfrom .models import Post\nautosync_model_to_vectordb(Post)\n</code></pre> <p>This will do exactly what we did above manually. It will also set the <code>dispatch_uid</code> for you.</p> <p>Then import the signals in your <code>apps.py</code></p> <pre><code>from django.apps import AppConfig\nclass BlogConfig(AppConfig):\ndefault_auto_field = \"django.db.models.BigAutoField\"\nname = \"blog\"\ndef ready(self):\nimport blog.signals\n</code></pre> <p>These signals will sync the vectors when you create and delete instances. Note that signals are not called in bulk create, so you will need to sync manually when using those methods.</p> <p>Ensure that your models implement the <code>get_vectordb_text()</code> and/or <code>get_vectordb_metadata()</code> methods for proper syncing.</p>"},{"location":"#searching","title":"Searching","text":"<p>To search, simply call <code>vectordb.search()</code>:</p> <pre><code>vectordb.search(\"Some text\", k=10) # k is the maximum number of results you want.\n</code></pre> <p>Note: search method returns a query whose results are order from best match. Each item will have the following fields: <code>id</code>, <code>content_object</code>, <code>object_id</code>, <code>content_type</code>, <code>text</code>, <code>embedding</code>, annotated <code>score</code>, and a property <code>vector</code> that returns the <code>np.ndarray</code> representation of the item. Because search gives us a <code>QuerySet</code> we can choose the fiels we want to see like sos:</p> <pre><code>vectordb.search(\"Some text\", k=10).only('text', 'content_object')\n</code></pre> <p>Search doesn't only work for <code>text</code> you can also search for model instances:</p> <pre><code>post1 = Post.objects.get(id=1)\n# Limit the search scope to a user with an id of 1\nresults = vectordb.search(post1, k=10)\n</code></pre> <p>This is also a way to get related posts to <code>post1</code>. Thus, you can use <code>vectordb</code> for recommendations as well.</p> <p>Note: Seaching by model instances will automatically scope the results to instances of that type. For example, if you search by <code>post1</code> you will only get results that are instances of <code>Post</code>.</p> <p>If <code>k</code> is not provided, the default value is 10.</p>"},{"location":"#filtering","title":"Filtering","text":"<p>You can filter on <code>text</code> or <code>metadata</code> with the full power of Django QuerySet filtering:</p> <pre><code># scope the search to user with an id 1\nvectordb.filter(metadata__user_id=1).search(\"Some text\", k=10)\n# example two with more filters\nvectordb.filter(text__icontains=\"Apple\", metadata__title__icontains=\"IPhone\", metadata__description__icontains=\"2023\").search(\"Apple new phone\", k=10)\n</code></pre> <p>We can also use model instances instead of text:</p> <pre><code>post1 = Post.objects.get(id=1)\n# Limit the search scope to a user with an id of 1\nresults = vectordb.filter(metadata__user_id=1).search(post1, k=10)\n# Scope the results to text which contains France, belonging to user with id 1 and created in 2023\nvectordb.filter(text__icontains=\"Apple\", metadata__title__icontains=\"IPhone\", metadata__description__icontains=\"2023\").search(post1, k=10)\n</code></pre> <p>Refer to the Django documentation on querying the <code>JSONField</code> for more information on filtering.</p>"},{"location":"#settings","title":"Settings","text":"<p>You can customize <code>vectordb</code> by providing your settings in the <code>settings.py</code> file of your project. The following settings are available:</p> <pre><code># settings.py\nDJANGO_VECTOR_DB = {\n\"DEFAULT_EMBEDDING_CLASS\": ..., # Default: \"vectordb.embedding_functions.SentenceTransformerEncoder\",\n\"DEFAULT_EMBEDDING_MODEL\": ..., # Default: \"all-MiniLM-L6-v2\",\n# Can be \"cosine\" or \"l2\"\n\"DEFAULT_EMBEDDING_SPACE\": ..., # Default \"l2\"\n\"DEFAULT_EMBEDDING_DIMENSION\": ..., # Default is 384 for \"all-MiniLM-L6-v2\"\n\"DEFAULT_MAX_N_RESULTS\": 10, # Number of results to return from search maximum is default is 10\n\"DEFAULT_MIN_SCORE\": 0.0, # Minimum score to return from search default is 0.0\n\"DEFAULT_MAX_BRUTEFORCE_N\": 10_000, # Maximum number of items to search using brute force default is 10_000. If the number of items is greater than this number, the search will be done using the HNSW index.\n}\n</code></pre>"},{"location":"#quickstart","title":"Quickstart","text":"<p>Can't wait to get started? The quickstart guide is the fastest way to get up and running, and building APIs with REST framework.</p>"},{"location":"#development","title":"Development","text":"<p>Clone the repository</p> <pre><code>$ git clone\n</code></pre> <p>Install the app in editable mode with all dev dependencies:</p> <pre><code>pip install -e .[dev]\n</code></pre> <p>This command will install the app and its dev dependencies specified in the <code>setup.cfg</code> file. The <code>-e</code> flag installs the package in editable mode, which means that any changes you make to the app's source code will be reflected immediately without needing to reinstall the package. The <code>[dev]</code> part tells <code>pip</code> to install the dependencies listed under the \"dev\" section in the <code>options.extras_require</code> of the <code>setup.cfg</code> file.</p> <p>Run tests</p> <pre><code>pytest\n</code></pre> <p>Or</p> <pre><code>tox\n</code></pre>"},{"location":"tutorial/1-project-setup/","title":"Tutorial 1: Project Setup","text":"<p>Welcome to this tutorial on <code>django-vectordb</code>! Our goal is to learn how to use <code>vectordb</code>. To make it more relatable, we'll demonstrate the features of <code>django-vectordb</code> by building a basic blogging site.</p> <p>In this first lesson, we'll lay the groundwork for our blogging site by creating a model to store blog posts and developing basic views for creating, viewing, and examining the details of each post. This is the most work we have to do. Integrating <code>django-vectordb</code> is very easy and straight forward.</p> <p>As we delve deeper, we will explore the capabilities of <code>django-vectordb</code> by integrating related blog suggestions on the details page, based on vector similarity searches. This will showcase the flexibility and easy of use and power of <code>django-vectordb</code>.</p> <p>In the later stages of our tutorial, we will add a search page to demonstrate the text search features. Finally, we'll configure a REST API endpoint that allows for efficient AJAX searching and remote hosting of vectordb.</p> <p>Now, with the introduction out of the way, let's get coding started!</p>"},{"location":"tutorial/1-project-setup/#project-setup","title":"Project setup","text":"<p>Create a new Django project named <code>tutorial</code>, then start a new app called <code>blog</code>.</p> <pre><code># Create a virtual environment to isolate our package dependencies locally\npython3 -m venv env\nsource env/bin/activate  # On Windows use `env\\Scripts\\activate`\n# Install Django and VectorDB into the virtual environment\npip install django\npip install django-vectordb[standard] # include optional dependencies\n# Set up a new project with a single application\ndjango-admin startproject tutorial\ncd tutorial\ndjango-admin startapp blog\n</code></pre> <p>The project layout should look like:</p> <pre><code>    tutorial\n    \u251c\u2500\u2500 blog\n    \u2502   \u251c\u2500\u2500 __init__.py\n    \u2502   \u251c\u2500\u2500 admin.py\n    \u2502   \u251c\u2500\u2500 apps.py\n    \u2502   \u251c\u2500\u2500 migrations\n    \u2502   \u2502   \u2514\u2500\u2500 __init__.py\n    \u2502   \u251c\u2500\u2500 models.py\n    \u2502   \u251c\u2500\u2500 tests.py\n    \u2502   \u2514\u2500\u2500 views.py\n    \u251c\u2500\u2500 manage.py\n    \u2514\u2500\u2500 tutorial\n        \u251c\u2500\u2500 __init__.py\n        \u251c\u2500\u2500 asgi.py\n        \u251c\u2500\u2500 settings.py\n        \u251c\u2500\u2500 urls.py\n        \u2514\u2500\u2500 wsgi.py\n</code></pre> <p>Now lets add blog to the <code>INSTALLED_APPS</code> in <code>tutorial/settings.py</code></p> tutorial/settings.py<pre><code># settings.py\nINSTALLED_APPS = [\n\"django.contrib.admin\",\n\"django.contrib.auth\",\n\"django.contrib.contenttypes\",\n\"django.contrib.sessions\",\n\"django.contrib.messages\",\n\"django.contrib.staticfiles\",\n\"blog\", # &lt;--\n]\n</code></pre> <p>Next lets add a <code>POST</code> model to blog app <code>blog/models.py</code> for saving our posts</p> blog/models.py<pre><code># blog/models.py\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\nUser = get_user_model()\nclass Post(models.Model):\ntitle = models.CharField(max_length=100)\ndescription = models.TextField()\nuser = models.ForeignKey(User, on_delete=models.CASCADE)\ncreated_at = models.DateTimeField(auto_now_add=True)\ndef __str__(self):\nreturn self.title\n</code></pre> <p>Our model has three fields, the <code>title</code>, <code>description</code>, <code>created_at</code>, and a <code>user</code> foreign key.</p> <p>Now sync your database for the first time:</p> <pre><code>python manage.py makemigrations # create migrations for blog\npython manage.py migrate\n</code></pre> <p>We'll also create an initial user named <code>admin</code> with a password. We'll authenticate as that user later in our example.</p> <pre><code>python manage.py createsuperuser --username admin --email admin@example.com\n</code></pre> <p>Once you've set up a database and the initial user is created and ready to go.</p> <p>Run the development server now</p> <pre><code>./manage.py runserver\n</code></pre>"},{"location":"tutorial/1-project-setup/#adding-sample-blogs","title":"Adding Sample Blogs","text":"<p>Lets add the Post model to the admins panel. Edit the <code>blog/admin.py</code></p> blog/admin.py<pre><code># blog/admin.py\nfrom django.contrib import admin\nfrom .models import Post\nadmin.site.register(Post)\n</code></pre> <p>Now we can visit <code>http://127.0.0.1:8000/admin/blog/post/</code> and add a few Posts. Go ahead and add something</p>"},{"location":"tutorial/1-project-setup/#forms","title":"Forms","text":"<p>In the last section we used the admin panel to add some post. Now lets add a form for post to the blogs.</p> <p>Create a new file in blog directory called <code>forms.py</code></p> blog/forms.py<pre><code># blog/forms.py\nfrom django import forms\nfrom .models import Post\nclass PostForm(forms.ModelForm):\nclass Meta:\nmodel = Post\nfields = [\"title\", \"description\"]\n</code></pre>"},{"location":"tutorial/1-project-setup/#views","title":"Views","text":"<p>Lets add some views for viewing our blog posts. We will keep things simple and use function based views.</p> <p>First create a directory called <code>templates</code> withing the blog app. Inside the <code>templates</code> directory create another folder called <code>blog</code>.</p> <p>Lets add a basic <code>base.html</code></p> blog/templates/blog/base.html<pre><code>&lt;!--blog/templates/blog/base.html--&gt;\n{% load static %}\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\" dir=\"ltr\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"utf-8\" /&gt;\n&lt;title&gt;Django Vector Database&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div class=\"container\"&gt;{% block content %} {% endblock %}&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Now lets create the list, detail, create view.</p> blog/views.py<pre><code>from django.shortcuts import render\nfrom django.contrib.auth.decorators import login_required\nfrom django.shortcuts import render, redirect, get_object_or_404\nfrom .models import Post\nfrom .forms import PostForm\ndef post_list(request):\nposts = Post.objects.all().order_by(\"-created_at\")\nreturn render(request, \"blog/post_list.html\", {\"posts\": posts})\ndef post_detail(request, pk):\npost = get_object_or_404(Post, pk=pk)\nreturn render(request, \"blog/post_detail.html\", {\"post\": post})\n@login_required\ndef post_create(request):\nif request.method == \"POST\":\nform = PostForm(request.POST)\nif form.is_valid():\npost = form.save(commit=False)\npost.user = request.user\npost.save()\nreturn redirect(\"post_list\")\nelse:\nform = PostForm()\nreturn render(request, \"blog/post_create.html\", {\"form\": form})\n</code></pre> <p>And finally, lets add the templates for these views.</p> <p>We will begin with a template that displays a list of blog posts with their titles as clickable links. The template extends the \"blog/base.html\" template. In case there are no posts, it displays the message \"No posts available.\" At the end, we add a link to create a new blog post using the \"post_create\" URL pattern.</p> blog/templates/blog/post_list.html<pre><code>&lt;!-- blog/templates/blog/post_list.html --&gt;\n{% extends \"blog/base.html\" %}\n{% block content %}\n&lt;h1&gt;Blog Posts&lt;/h1&gt;\n&lt;ul&gt;\n{% for post in posts %}\n&lt;li&gt;\n&lt;a href=\"{% url 'post_detail' post.pk %}\"&gt;{{ post.title }}&lt;/a&gt;\n&lt;/li&gt;\n{% empty %}\n&lt;li&gt;No posts available.&lt;/li&gt;\n{% endfor %}\n&lt;/ul&gt;\n&lt;a href=\"{% url 'post_create' %}\"&gt;Add New Post&lt;/a&gt;\n{% endblock %}\n</code></pre> <p>Next we add the template \"post_detail.html\" responsible for displaying the details of a single blog post. The template also includes a link to navigate back to the list of all blog posts.</p> blog/templates/blog/post_detail.html<pre><code>&lt;!-- blog/templates/blog/post_detail.html --&gt;\n{% extends \"blog/base.html\" %}\n{% block content %}\n&lt;h1&gt;{{ post.title }}&lt;/h1&gt;\n&lt;p&gt;{{ post.description }}&lt;/p&gt;\n&lt;a href=\"{% url 'post_list' %}\"&gt;Back to Posts List&lt;/a&gt;\n{% endblock %}\n</code></pre> blog/templates/blog/post_create.html<pre><code>&lt;!-- blog/templates/blog/post_create.html --&gt;\n{% extends \"blog/base.html\" %}\n{% block content %}\n&lt;h1&gt;Create New Post&lt;/h1&gt;\n&lt;form method=\"post\"&gt;\n{% csrf_token %} {{ form.as_p }}\n&lt;button type=\"submit\"&gt;Save Post&lt;/button&gt;\n&lt;/form&gt;\n&lt;a href=\"{% url 'post_list' %}\"&gt;Back to Posts List&lt;/a&gt;\n{% endblock %}\n</code></pre> <p>That covers the basic functionality we want to work with. However, there's still one more aspect to address. We need to ensure that users are associated with their respective blogs, which means providing a way for them to log in to the app for the post functionality to work correctly. As evident from the code, posting requires user authentication.</p> <p>So lets create a quick login form in <code>blog/templates/blog/login.html</code></p> blog/templates/blog/login.html<pre><code>&lt;!-- blog/templates/blog/login.html --&gt;\n{% extends 'blog/base.html' %}\n{% block content %}\n&lt;h2&gt;Login&lt;/h2&gt;\n&lt;form method=\"post\"&gt;\n{% csrf_token %} {{ form.as_p }}\n&lt;button type=\"submit\"&gt;Login&lt;/button&gt;\n&lt;/form&gt;\n{% endblock %}\n</code></pre>"},{"location":"tutorial/1-project-setup/#urls","title":"URLs","text":"<p>Lets now add the urls for our views. Create a new file called <code>urls.py</code> in the blog app.</p> blog/urls.py<pre><code>from django.urls import path\n# import login view\nfrom django.contrib.auth.views import LoginView\nfrom . import views\nurlpatterns = [\npath(\"\", views.post_list, name=\"post_list\"),\npath(\"blogs/&lt;int:pk&gt;/\", views.post_detail, name=\"post_detail\"),\npath(\"blogs/create/\", views.post_create, name=\"post_create\"),\npath(\n\"accounts/login/\",\nLoginView.as_view(template_name=\"blog/login.html\"), # attach a template here\nname=\"login\",\n),\n]\n</code></pre> <p>This wraps up the boilerplate necessary for testing the Django vector database. Now when we run the server</p> <pre><code>./manage.py runserver\n</code></pre> <p>When we visit [https://127.0.0.1/][app-index] we will see </p> <p>And clicking the add button we will take us to </p> <p>And we can view the details of the post by clicking the title.</p>"},{"location":"tutorial/1-project-setup/#summary","title":"Summary","text":"<p>In this tutorial we create a basic project to work with Django Vector Database. We created all the basic views and forms we need to create and view posts. Next lets integrated django vector database</p>"},{"location":"tutorial/2-adding-vector-search/","title":"Tutorial 2: Integrating Django Vector Database in our Blog Site","text":"<p>Welcome to Tutorial 2! In this tutorial, we will be integrating the <code>django-vectordb</code> into our Blog Site. By the end of this tutorial, we will:</p> <ul> <li>Integrate <code>django-vectordb</code> into our project.</li> <li>Update our Post model to allow <code>django-vectordb</code> to automatically extract the text for vector search, as well as any metadata we want to filter on.</li> <li>Update the vector database with all the blog Posts that are currently on our site.</li> <li>Configure our site to automatically sync with the vector database whenever we <code>create</code>, <code>update</code> or <code>delete</code> posts.</li> <li>Configure our site to display related blog recommendations using the <code>django-vectordb</code>.</li> </ul> <p>Let's get started!</p>"},{"location":"tutorial/2-adding-vector-search/#adding-vectordb","title":"Adding VectorDB","text":"<p>If you haven't installed vectordb already install it</p> <pre><code>pip install \"django-vectordb[standard]\"\n</code></pre> <p>Next lets add <code>django-vectordb</code> to the <code>INSTALLED_APPS</code>. Open <code>tutorial/settings.py</code> and add <code>vectordb</code> to the installed apps.</p> tutorial/settings.py<pre><code># settings.py\nINSTALLED_APPS = [\n\"django.contrib.admin\",\n\"django.contrib.auth\",\n\"django.contrib.contenttypes\",\n\"django.contrib.sessions\",\n\"django.contrib.messages\",\n\"django.contrib.staticfiles\",\n\"blog\",\n\"vectordb\", # &lt;--\n]\n</code></pre> <p>Finally, lets run the migrations to create the <code>vectordb</code> table.</p> <pre><code>./manage.py migrate\n</code></pre>"},{"location":"tutorial/2-adding-vector-search/#update-post-model-for-vectordb-to-automatically-extract-text-and-metadata","title":"Update Post Model for VectorDB to Automatically Extract Text and Metadata","text":"<p>Next lets add to methods to our model to allow vectordb to properly index our Posts.</p> <p>First we need to pick the text we want to search by. For this tutorial we use both the <code>title</code> and the <code>description</code> of each blog.</p> blog/models.py<pre><code># blog/models.py\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\nUser = get_user_model()\nclass Post(models.Model):\ntitle = models.CharField(max_length=100)\ndescription = models.TextField()\nuser = models.ForeignKey(User, on_delete=models.CASCADE)\ncreated_at = models.DateTimeField(auto_now_add=True)\ndef get_vectordb_text(self):\nreturn self.title + \" \" + self.description\ndef get_vectordb_metadata(self):\nreturn {\n\"user_id\": self.user.id,\n\"username\": self.user.username,\n\"created_at_year\": self.created_at.year,\n\"created_at_month\": self.created_at.month,\n}\n</code></pre> <p>Documentation Writing in progress -- check back soon!</p>"},{"location":"tutorial/3-manually-updating-vector-database/","title":"3 - Manually Updating Vector Database","text":""},{"location":"tutorial/3-manually-updating-vector-database/#coming-soon","title":"Coming Soon","text":""},{"location":"tutorial/4-manually-updating-vector-database/","title":"4 - Manually Updating Vector Database","text":""},{"location":"tutorial/4-manually-updating-vector-database/#coming-soon","title":"Coming Soon","text":""},{"location":"tutorial/5-automatic-syncing/","title":"5 - Automatically Syncing Our Models to Vector Database","text":""},{"location":"tutorial/5-automatic-syncing/#coming-soon","title":"Coming Soon","text":""},{"location":"tutorial/6-vector-search/","title":"6 - Vector Searching","text":""},{"location":"tutorial/6-vector-search/#coming-soon","title":"Coming Soon","text":""},{"location":"tutorial/7-adding-api-endpoint/","title":"7 - Adding a Vector Search Endpoint","text":""},{"location":"tutorial/7-adding-api-endpoint/#coming-soon","title":"Coming soon","text":""},{"location":"tutorial/quickstart/","title":"Quickstart","text":"<p>We're going to create a blogging site then add vector search to it through <code>django-vectordb</code>.</p>"},{"location":"tutorial/quickstart/#project-setup","title":"Project setup","text":"<p>Create a new Django project named <code>tutorial</code>, then start a new app called <code>blog</code>.</p> <pre><code># Create a virtual environment to isolate our package dependencies locally\npython3 -m venv env\nsource env/bin/activate  # On Windows use `env\\Scripts\\activate`\n# Install Django and Django VectorDB into the virtual environment\npip install django\npip install django-vectordb[standard] # include optional dependencies\n# Set up a new project with a single application\ndjango-admin startproject tutorial\ncd tutorial\ndjango-admin startapp blog\n</code></pre> <p>The project layout should look like:</p> <pre><code>    tutorial\n    \u251c\u2500\u2500 blog\n    \u2502   \u251c\u2500\u2500 __init__.py\n    \u2502   \u251c\u2500\u2500 admin.py\n    \u2502   \u251c\u2500\u2500 apps.py\n    \u2502   \u251c\u2500\u2500 migrations\n    \u2502   \u2502   \u2514\u2500\u2500 __init__.py\n    \u2502   \u251c\u2500\u2500 models.py\n    \u2502   \u251c\u2500\u2500 tests.py\n    \u2502   \u2514\u2500\u2500 views.py\n    \u251c\u2500\u2500 manage.py\n    \u2514\u2500\u2500 tutorial\n        \u251c\u2500\u2500 __init__.py\n        \u251c\u2500\u2500 asgi.py\n        \u251c\u2500\u2500 settings.py\n        \u251c\u2500\u2500 urls.py\n        \u2514\u2500\u2500 wsgi.py\n</code></pre> <p>Now sync your database for the first time:</p> <pre><code>python manage.py makemigrations # create migrations for blog\npython manage.py migrate\n</code></pre> <p>We'll also create an initial user named <code>admin</code> with a password. We'll authenticate as that user later in our example.</p> <pre><code>    python manage.py createsuperuser --username admin --email admin@example.com\n</code></pre> <p>Now lets add <code>blog</code> app and <code>vectordb</code> to the <code>INSTALLED_APPS</code> in <code>tutorial/settings.py</code></p> tutorial/settings.py<pre><code># settings.py\nINSTALLED_APPS = [\n'django.contrib.admin',\n'django.contrib.auth',\n'django.contrib.contenttypes',\n'django.contrib.sessions',\n'django.contrib.messages',\n'django.contrib.staticfiles',\n\"blog\", # add blog to here\n\"vectordb\", # add vectordb to here. The order is not important though\n]\n</code></pre> <p>Next, let's add a <code>POST</code> model to our blog app by modifying <code>blog/models.py</code>, which will enable us to save our posts. Additionally, we will include the <code>get_vectordb_text</code> method to specify the text we want to search by in <code>vectordb</code>. We will also implement the <code>get_vectordb_metadata</code> method to incorporate specific fields we wish to filter by. If we don't create our custom <code>get_vectordb_metadata</code>, <code>vectordb</code> will serialize all the fields into metadata, which could be suboptimal as we might not be interested in some of the fields added. Therefore, it is recommended to implement our own <code>get_vectordb_metadata</code> that contains only the fields we want to filter by. These methods will allow <code>vectordb</code> to perform additional functions for us.</p> blog/models.py<pre><code># blog/models.py\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\nUser = get_user_model()\nclass Post(models.Model):\ntitle = models.CharField(max_length=100)\ndescription = models.TextField()\nuser = models.ForeignKey(User, on_delete=models.CASCADE)\ncreated_at = models.DateTimeField(auto_now_add=True)\ndef get_vectordb_text(self):\nreturn self.title + \" \" + self.description\ndef get_vectordb_metadata(self):\nreturn {\n# so we can filter by user id\n\"user_id\": self.user.id,\n# so we can filter by username\n\"username\": self.user.username,\n# so we can filter by created_at_year\n\"created_at_year\": self.created_at.year,\n# so we can filter by created_at_month\n\"created_at_month\": self.created_at.month,\n}\ndef __str__(self):\nreturn self.title\n</code></pre> <p>Our model has three fields, the <code>title</code>, <code>description</code>, <code>created_at</code>, and a <code>user</code> foreign key. In the metadata we include the <code>user_id</code>, <code>username</code>, <code>created_at_year</code>, and <code>created_at_month</code>. We will use these fields to filter our results later.</p> <p>Now lets make migrations and make tables for the <code>blog</code> app and the <code>vectordb</code> app.</p> <pre><code>python manage.py makemigrations\npython manage.py migrate\n</code></pre> <p>Run the development server now</p> <pre><code>./manage.py runserver\n</code></pre>"},{"location":"tutorial/quickstart/#adding-sample-blogs","title":"Adding Sample Blogs","text":"<p>Lets add the Post model to the admins panel. Edit the <code>blog/admin.py</code></p> blog/admin.py<pre><code># blog/admin.py\nfrom django.contrib import admin\nfrom .models import Post\nadmin.site.register(Post)\n</code></pre> <p>Now we can visit http://127.0.0.1:8000/admin/blog/post/ and add a few Posts. Go ahead and add something</p>"},{"location":"tutorial/quickstart/#configuring-vector-search","title":"Configuring Vector Search","text":"<p>First, let's synchronize all posts with the vector database. To do this, simply run the following command:</p> <pre><code>python manage.py vectordb_sync &lt;app_name&gt; &lt;model_name&gt;\n</code></pre> <p>For this example we run:</p> <pre><code>python manage.py vectordb_sync blog Post\n</code></pre> <p>Lastly, let's make sure that the Post model remains synchronized with the vector database, so that any changes, such as creating, deleting, or updating posts, are automatically registered by <code>vectordb</code>. To do this, we'll create a <code>signals.py</code> file in the blog directory and input the following code:</p> blog/signals.py<pre><code>from vectordb.shortcuts import autosync_model_to_vectordb\nfrom .models import Post\nautosync_model_to_vectordb(Post)\n</code></pre> <p>The above code is equivalent to doing the following manually:</p> blog/signals.py<pre><code># blog/signals.py\nfrom django.db.models.signals import post_save, post_delete\nfrom vectordb.sync_signals import (\nsync_vectordb_on_create_update,\nsync_vectordb_on_delete,\n)\nfrom .models import Post\npost_save.connect(\nsync_vectordb_on_create_update,\nsender=Post,\ndispatch_uid=\"update_vector_index_super_unique_id\",\n)\npost_delete.connect(\nsync_vectordb_on_delete,\nsender=Post,\ndispatch_uid=\"delete_vector_index_super_unique_id\",\n)\n</code></pre> <p>Then import the signals in your <code>apps.py</code></p> blog/apps.py<pre><code># blog/apps.py\nfrom django.apps import AppConfig\nclass BlogConfig(AppConfig):\ndefault_auto_field = \"django.db.models.BigAutoField\"\nname = \"blog\"\n# add ready method if not defined\ndef ready(self):\n# import signals\nimport blog.signals\n</code></pre> <p>Now we can run the development server again</p> <pre><code>./manage.py runserver\n</code></pre> <p>Visit http://127.0.0.1:8000/admin/blog/post/ and try adding a new post. You will notice that it automatically syncs with the vector database at http://127.0.0.1:8000/admin/vectordb/vector/. If you attempt to delete a post, it will also be automatically removed from the vector database. All of these features are provided out-of-the-box by <code>vectordb</code>, making the process seamless and efficient.</p>"},{"location":"tutorial/quickstart/#fast-vector-search","title":"Fast Vector Search","text":"<p>To perform a search, simply invoke the <code>vectordb.search()</code> method:</p> <pre><code>from vectordb import vectordb\nresults = vectordb.search(\"A Culinary Journey\", k=10) # k represents the maximum number of results desired.\n# get the search time in seconds\nprint(results.search_time) # only available if search is the last method called\n</code></pre> <p>Note that the search method returns a QuerySet with results ordered by the best match. The QuerySet will also have the search_time in seconds which only available when search is the last method called on the QuerySet. Each result item will contain the following fields: <code>id</code>, <code>content_object</code>, <code>object_id</code>, <code>content_type</code>, <code>text</code>, <code>embedding</code>, an annotated <code>score</code>, and a <code>vector</code> property that returns the <code>np.ndarray</code> representation of the embedding field, which is in <code>bytes</code>. As the search provides a <code>QuerySet</code>, you can selectively display the fields you want like this:</p> <pre><code>from vectordb import vectordb\nresults = vectordb.search(\"A Culinary Journey\", k=10).only('text', 'content_object')\n</code></pre> <p>If <code>k</code> is not specified, the default value is 10.</p> <p>Search doesn't only work for <code>text</code> you can also search for model instances:</p> <pre><code>post1 = Post.objects.get(id=1)\n# Limit the search scope to a user with an id of 1\nresults = vectordb.search(post1, k=10)\n</code></pre> <p>This is also a way to get related posts to <code>post1</code>. Thus, you can use <code>vectordb</code> for recommendations as well.</p> <p>Note: Seaching by model instances will automatically scope the results to instances of that type. For example, if you search by <code>post1</code> you will only get results that are instances of <code>Post</code>.</p>"},{"location":"tutorial/quickstart/#filtering","title":"Filtering","text":"<p>You can apply filters on <code>text</code> or <code>metadata</code> using the full capabilities of Django QuerySet filtering:</p> <pre><code># Limit the search scope to a user with an id of 1\nresults = vectordb.filter(metadata__user_id=1).search(\"A Culinary Journey\", k=10)\n# Scope the results to text which contains France, belonging to user with id 1 and created in 2023\nvectordb.filter(text__icontains=\"France\", metadata__user_id=1, metadata__create_at_year=2023).search(\"A Culinary Journey\", k=10)\n</code></pre> <p>We can also use model instances instead of text:</p> <pre><code>post1 = Post.objects.get(id=1)\n# Limit the search scope to a user with an id of 1\nresults = vectordb.filter(metadata__user_id=1).search(post1, k=10)\n# Scope the results to text which contains France, belonging to user with id 1 and created in 2023\nvectordb.filter(text__icontains=\"France\", metadata__user_id=1, metadata__create_at_year=2023).search(post1, k=10)\n</code></pre> <p>For more information on filtering, refer to the Django documentation on querying the <code>JSONField</code>.</p>"},{"location":"tutorial/quickstart/#manually-adding-items-to-the-vector-database","title":"Manually Adding Items to the Vector Database","text":"<p>VectorDB also provides a way to manually add items to it. This is useful if you want to add items to the database that are not in the database yet.</p> <p>VectorDB provides two utility methods for adding items to the database: <code>vectordb.add_instance</code> or <code>vectordb.add_text</code>. Note that for adding the instance, you need to provide the <code>get_vectordb_text</code> and an optional <code>get_vectordb_metadata</code> methods.</p>"},{"location":"tutorial/quickstart/#1-adding-model-instances","title":"1. Adding Model Instances","text":"<pre><code>post1 = models.create(title=\"post1\", description=\"post1 description\", user=user1) # provide valid user\n# add to vector database\nvectordb.add_instance(post1)\n</code></pre>"},{"location":"tutorial/quickstart/#2-adding-text-to-the-model","title":"2. Adding Text to the Model","text":"<p>To add text to the database, you can use <code>vectordb.add_text()</code>:</p> <pre><code>vectordb.add_text(text=\"Hello text\", id=3, metadata={\"user_id\": 1})\n</code></pre> <p>The <code>text</code> and <code>id</code> are required. Additionally, the <code>id</code> must be unique, or an error will occur. <code>metadata</code> can be <code>None</code> or any valid JSON.</p>"},{"location":"tutorial/quickstart/#settings","title":"Settings","text":"<p>You can customize <code>vectordb</code> by providing your settings in the <code>settings.py</code> file of your project. The following settings are available:</p> settings.py<pre><code># settings.py\nDJANGO_VECTOR_DB = {\n\"DEFAULT_EMBEDDING_CLASS\": ..., # Default: \"vectordb.embedding_functions.SentenceTransformerEncoder\",\n\"DEFAULT_EMBEDDING_MODEL\": ..., # Default: \"all-MiniLM-L6-v2\",\n# Can be \"cosine\" or \"l2\"\n\"DEFAULT_EMBEDDING_SPACE\": ..., # Default \"l2\"\n\"DEFAULT_EMBEDDING_DIMENSION\": ..., # Default is 384 for \"all-MiniLM-L6-v2\"\n\"DEFAULT_MAX_N_RESULTS\": 10, # Number of results to return from search maximum is default is 10\n\"DEFAULT_MIN_SCORE\": 0.0, # Minimum score to return from search default is 0.0\n\"DEFAULT_MAX_BRUTEFORCE_N\": 10_000, # Maximum number of items to search using brute force default is 10_000. If the number of items is greater than this number, the search will be done using the HNSW index.\n}\n</code></pre>"},{"location":"tutorial/quickstart/#summary","title":"Summary","text":"<p>Great! That was a quickstart to <code>django-vectordb</code>. We've created a blogging site and added extremely fast vector search to it. If you want to get a more in depth understanding of <code>vectordb</code> head on over to the tutorial.</p>"}]}